import{t as w,a as _,e as ee,b as te}from"../chunks/CLAry2k1.js";import{i as xe}from"../chunks/DdeQhgMz.js";import{p as he,o as ye,m as we,g as e,l as $e,a as Le,b as Ee,c as y,s as l,$ as Se,d as u,e as m,r as c,t as N,f as ke,h as ae,n as j}from"../chunks/CHWvRFv0.js";import{h as Ce,s as b}from"../chunks/I2gD431L.js";import{i as q}from"../chunks/BO9lghZz.js";import{r as Re,e as Ie,s as Fe}from"../chunks/rhR0QdnA.js";import{b as Me}from"../chunks/BgFIFfUn.js";import{s as se}from"../chunks/DgHr3P3x.js";import{c as Ne}from"../chunks/BqI594Fa.js";var qe=w("<p>Loading log entries...</p>"),Ae=w('<p class="text-red-500"> </p>'),De=w('<div class="flex flex-wrap items-center gap-x-1 gap-y-1 text-xs"><span class="bg-blue-200 text-blue-900 px-1 py-0.5 rounded-md font-medium"> </span> <span class="bg-green-200 text-green-900 px-1 py-0.5 rounded-md font-medium"> <span class="text-green-700 text-[0.65rem]">PFC</span></span> <span class="bg-yellow-200 text-yellow-900 px-1 py-0.5 rounded-md font-medium"> <span class="text-yellow-700 text-[0.65rem]">FiS</span></span> <span class="bg-orange-200 text-orange-900 px-1 py-0.5 rounded-md font-medium"> <span class="text-orange-700 text-[0.65rem]">MPS</span></span> <span class="bg-orange-200 text-orange-900 px-1 py-0.5 rounded-md font-medium" title="Omega-6:Omega-3 Ratio"> <span class="text-orange-700 text-[0.65rem]">6:3</span></span> <span class="bg-purple-200 text-purple-900 px-1 py-0.5 rounded-md font-medium"> </span></div>'),Oe=w('<p class="text-sm text-gray-500">Select log entries below to see totals.</p>'),Pe=w('<li><button type="button"> <span class="text-xs text-gray-500 block mt-1"> </span></button></li>'),ze=w("<p>No log entries found.</p>"),je=w('<p class="text-green-500 mb-4"> </p>'),Ge=w('<div class="mb-4 p-3 border rounded bg-gray-100 sticky top-0 z-10"><h2 class="text-lg font-semibold mb-2"> </h2> <!></div> <div class="mb-4"><label for="recipeName" class="block text-sm font-medium mb-1">Recipe Name:</label> <input type="text" id="recipeName" class="w-full max-w-xs px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter name for new recipe"></div> <div class="mb-4"><h2 class="text-lg font-semibold mb-2">Select Log Entries to Include:</h2> <ul class="space-y-2"></ul></div> <!> <button type="button" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50"><!></button>',1),Ke=w('<div class="container mx-auto p-4 max-w-5xl"><div class="flex justify-between items-center mb-4"><h1 class="text-2xl font-bold">Create Recipe from Log</h1> <a href="/recipes/generate" class="px-3 py-1.5 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Generate Recipe with AI</a></div> <!></div>');function Ye(oe,re){he(re,!1);const V=y();let I=y([]),d=y(new Set),$=y(""),A=y(!0),E=y(!1),L=y(""),D=y("");async function ie(){l(A,!0),l(L,"");try{const{data:t,error:x}=await se.from("food_log").select(`
          id,
          logged_at,
          multiplier,
          food_item_id,
          food_items ( id, name, serving_qty, serving_unit, protein, fat, carbs, fibers, sugar, mufa, pufa, sfa, gl, omega3, omega6 )
        `).order("logged_at",{ascending:!1}).limit(100);if(x)throw x;l(I,(t==null?void 0:t.map(p=>({id:p.id,logged_at:p.logged_at,multiplier:p.multiplier,food_item_id:p.food_item_id,food_items:(()=>{let v=null;if(p.food_items&&(Array.isArray(p.food_items)&&p.food_items.length>0?v=p.food_items[0]:Array.isArray(p.food_items)||(v=p.food_items)),v){const{calories:r,...i}=v;return i}return null})()})))||[])}catch(t){console.error("Error fetching logs:",t),l(L,t.message||"Failed to fetch logs."),l(I,[])}finally{l(A,!1)}}ye(ie);function ne(t){e(d).has(t)?e(d).delete(t):e(d).add(t),l(d,e(d)),W()}const G=["protein","fat","carbs","fibers","sugar","mufa","pufa","sfa","gl","omega3","omega6"];let a=y({count:0});G.forEach(t=>we(a,e(a)[t]=0));function W(){const t={count:0};G.forEach(i=>t[i]=0);let x=0;for(const i of e(I))if(e(d).has(i.id)&&i.food_items){x++;const n=i.food_items,f=i.multiplier,g=(T,U)=>(T||0)+(U||0);t.protein=g(t.protein,(n.protein||0)*f),t.fat=g(t.fat,(n.fat||0)*f),t.carbs=g(t.carbs,(n.carbs||0)*f),t.fibers=g(t.fibers,(n.fibers||0)*f),t.sugar=g(t.sugar,(n.sugar||0)*f),t.mufa=g(t.mufa,(n.mufa||0)*f),t.pufa=g(t.pufa,(n.pufa||0)*f),t.sfa=g(t.sfa,(n.sfa||0)*f),t.gl=g(t.gl,(n.gl||0)*f),t.omega3=g(t.omega3,(n.omega3||0)*f),t.omega6=g(t.omega6,(n.omega6||0)*f)}t.count=x;for(const i of G)t[i]=Math.round(t[i]);const p=t.omega3??0,v=t.omega6??0;let r="-";p>0?r=`${(v/p).toFixed(1)}:1`:v>0&&(r="âˆž:1"),t.ratio=r,l(a,t)}async function le(){if(!e($)||e(d).size===0)return;l(E,!0),l(L,""),l(D,"");const t=e(I).filter(r=>e(d).has(r.id));if(t.length===0){l(L,"No valid log entries selected."),l(E,!1);return}const p=`Made from:
- ${t.map(r=>{var i,n,f;return`(${((i=r.food_items)==null?void 0:i.serving_qty)||1} ${((n=r.food_items)==null?void 0:n.serving_unit)||"serving"}) x ${r.multiplier} ${((f=r.food_items)==null?void 0:f.name)||"(Unknown Item)"}`}).join(`
- `)}`,v={name:e($).trim(),serving_qty:1,serving_unit:"recipe serving",protein:e(a).protein??0,fat:e(a).fat??0,carbs:e(a).carbs??0,fibers:e(a).fibers??0,sugar:e(a).sugar??0,mufa:e(a).mufa??0,pufa:e(a).pufa??0,sfa:e(a).sfa??0,gl:e(a).gl??0,omega3:e(a).omega3??0,omega6:e(a).omega6??0,comment:p};try{const{error:r}=await se.from("food_items").insert([v]);if(r)throw r;l(D,`Recipe "${e($).trim()}" created successfully!`),l($,""),e(d).clear(),l(d,e(d)),W()}catch(r){console.error("Error creating recipe:",r),l(L,`Failed to create recipe: ${r.message}`)}finally{l(E,!1)}}$e(()=>(e($),e(d),e(E)),()=>{l(V,!e($)||e(d).size===0||e(E))}),Le(),xe();var K=Ke();Ce(t=>{Se.title="Create Recipe - Eatelligence"});var ce=u(m(K),2);{var fe=t=>{var x=qe();_(t,x)},me=(t,x)=>{{var p=r=>{var i=Ae(),n=m(i,!0);c(i),N(()=>b(n,e(L))),_(r,i)},v=r=>{var i=Ge(),n=ke(i),f=m(n),g=m(f);c(f);var T=u(f,2);{var U=o=>{var s=De(),h=m(s),S=m(h);c(h);var k=u(h,2),P=m(k);j(),c(k);var C=u(k,2),J=m(C);j(),c(C);var F=u(C,2),Q=m(F);j(),c(F);var R=u(F,2),z=m(R);j(),c(R);var M=u(R,2),_e=m(M);c(M),c(s),N(be=>{b(S,`${be??""} C`),b(P,`${e(a).protein??0??""}, ${e(a).fat??0??""}, ${e(a).carbs??0??""} `),b(J,`${e(a).fibers??0??""}, ${e(a).sugar??0??""} `),b(Q,`${e(a).mufa??0??""}, ${e(a).pufa??0??""}, ${e(a).sfa??0??""} `),b(z,`${e(a).ratio??"-"??""} `),b(_e,`${e(a).gl??0??""} GL`)},[()=>Ne(e(a))],ae),_(o,s)},de=o=>{var s=Oe();_(o,s)};q(T,o=>{e(a).count>0?o(U):o(de,!1)})}c(n);var B=u(n,2),X=u(m(B),2);Re(X),c(B);var H=u(B,2),Y=u(m(H),2);Ie(Y,5,()=>e(I),o=>o.id,(o,s)=>{var h=Pe(),S=m(h);let k;var P=m(S),C=u(P),J=m(C);c(C),c(S),c(h),N((F,Q)=>{var R,z,M;k=Fe(S,1,"w-full text-left p-3 border rounded cursor-pointer transition-colors block",null,k,F),b(P,`${((R=e(s).food_items)==null?void 0:R.name)||"(Deleted Item)"} - (${((z=e(s).food_items)==null?void 0:z.serving_qty)||1} ${((M=e(s).food_items)==null?void 0:M.serving_unit)||"serving"}) x ${e(s).multiplier??""} `),b(J,`Logged: ${Q??""}`)},[()=>({"bg-indigo-100":e(d).has(e(s).id),"text-indigo-900":e(d).has(e(s).id),"hover:bg-gray-100":!e(d).has(e(s).id),"bg-white":!e(d).has(e(s).id)}),()=>new Date(e(s).logged_at).toLocaleString("sv-SE")],ae),ee("click",S,()=>ne(e(s).id)),_(o,h)},o=>{var s=ze();_(o,s)}),c(Y),c(H);var Z=u(H,2);{var pe=o=>{var s=je(),h=m(s,!0);c(s),N(()=>b(h,e(D))),_(o,s)};q(Z,o=>{e(D)&&o(pe)})}var O=u(Z,2),ue=m(O);{var ge=o=>{var s=te("Creating...");_(o,s)},ve=o=>{var s=te("Create Recipe");_(o,s)};q(ue,o=>{e(E)?o(ge):o(ve,!1)})}c(O),N(()=>{b(g,`Selected Items Summary (${e(a).count??""} items)`),O.disabled=e(V)}),Me(X,()=>e($),o=>l($,o)),ee("click",O,le),_(r,i)};q(t,r=>{e(L)&&!e(A)?r(p):r(v,!1)},x)}};q(ce,t=>{e(A)?t(fe):t(me,!1)})}c(K),_(oe,K),Ee()}export{Ye as component};
