import{t as w,a as f,c as Ut,e as K,b as it}from"../chunks/CLAry2k1.js";import{i as It}from"../chunks/DdeQhgMz.js";import{aw as ta,p as jt,l as lt,s,c as H,ap as Le,g as e,a as Lt,e as i,r as n,b as Dt,f as Qe,t as J,d as v,h as Se,aR as aa,aS as ra,o as oa,aT as na,n as Ee,i as ia}from"../chunks/CHWvRFv0.js";import{s as $}from"../chunks/I2gD431L.js";import{i as B}from"../chunks/BO9lghZz.js";import{s as st,e as dt,d as Nt,i as sa,a as De,r as Et}from"../chunks/rhR0QdnA.js";import{b as Ot}from"../chunks/BgFIFfUn.js";import{s as je}from"../chunks/DgHr3P3x.js";import{F as la}from"../chunks/Ch1WBRTM.js";import{c as Ft}from"../chunks/BqI594Fa.js";import{s as da}from"../chunks/Bfc47y5P.js";import{p as _e}from"../chunks/B4_PvOgV.js";function ca(r,c){var z;var p=(z=r.$$events)==null?void 0:z[c.type],D=ta(p)?p.slice():p==null?[]:[p];for(var C of D)C.call(this,c)}var ua=typeof global=="object"&&global&&global.Object===Object&&global,fa=typeof self=="object"&&self&&self.Object===Object&&self,Wt=ua||fa||Function("return this")(),ct=Wt.Symbol,Bt=Object.prototype,ma=Bt.hasOwnProperty,pa=Bt.toString,Je=ct?ct.toStringTag:void 0;function ga(r){var c=ma.call(r,Je),p=r[Je];try{r[Je]=void 0;var D=!0}catch{}var C=pa.call(r);return D&&(c?r[Je]=p:delete r[Je]),C}var va=Object.prototype,_a=va.toString;function ba(r){return _a.call(r)}var xa="[object Null]",ya="[object Undefined]",At=ct?ct.toStringTag:void 0;function ha(r){return r==null?r===void 0?ya:xa:At&&At in Object(r)?ga(r):ba(r)}function wa(r){return r!=null&&typeof r=="object"}var Sa="[object Symbol]";function Ta(r){return typeof r=="symbol"||wa(r)&&ha(r)==Sa}var Ma=/\s/;function ka(r){for(var c=r.length;c--&&Ma.test(r.charAt(c)););return c}var Ea=/^\s+/;function Oa(r){return r&&r.slice(0,ka(r)+1).replace(Ea,"")}function Pt(r){var c=typeof r;return r!=null&&(c=="object"||c=="function")}var Vt=NaN,$a=/^[-+]0x[0-9a-f]+$/i,Fa=/^0b[01]+$/i,Pa=/^0o[0-7]+$/i,Ia=parseInt;function Rt(r){if(typeof r=="number")return r;if(Ta(r))return Vt;if(Pt(r)){var c=typeof r.valueOf=="function"?r.valueOf():r;r=Pt(c)?c+"":c}if(typeof r!="string")return r===0?r:+r;r=Oa(r);var p=Fa.test(r);return p||Pa.test(r)?Ia(r.slice(2),p?2:8):$a.test(r)?Vt:+r}var $t=function(){return Wt.Date.now()},ja="Expected a function",La=Math.max,Da=Math.min;function Ca(r,c,p){var D,C,z,q,k,Y,N=0,fe=!1,Q=!1,ne=!0;if(typeof r!="function")throw new TypeError(ja);c=Rt(c)||0,Pt(p)&&(fe=!!p.leading,Q="maxWait"in p,z=Q?La(Rt(p.maxWait)||0,c):z,ne="trailing"in p?!!p.trailing:ne);function ce(d){var x=D,A=C;return D=C=void 0,N=d,q=r.apply(A,x),q}function ie(d){return N=d,k=setTimeout(se,c),fe?ce(d):q}function ae(d){var x=d-Y,A=d-N,u=c-x;return Q?Da(u,z-A):u}function X(d){var x=d-Y,A=d-N;return Y===void 0||x>=c||x<0||Q&&A>=z}function se(){var d=$t();if(X(d))return E(d);k=setTimeout(se,ae(d))}function E(d){return k=void 0,ne&&D?ce(d):(D=C=void 0,q)}function l(){k!==void 0&&clearTimeout(k),N=0,D=Y=C=k=void 0}function F(){return k===void 0?q:E($t())}function b(){var d=$t(),x=X(d);if(D=arguments,C=this,Y=d,x){if(k===void 0)return ie(Y);if(Q)return clearTimeout(k),k=setTimeout(se,c),ce(Y)}return k===void 0&&(k=setTimeout(se,c)),q}return b.cancel=l,b.flush=F,b}var Na=w("<div></div>"),Aa=w('<div><!> <div></div></div> <div class="flex justify-between text-xs text-gray-500 mt-0.5 px-0.5"><span> </span> <span> </span></div>',1),Va=w('<div title="Actual value not available"><div class="flex justify-between text-xs text-gray-500 mt-0.5 px-0.5"><span>N/A</span> <span>N/A</span></div></div>'),Ra=w('<div class="w-full"><!></div>');function Ua(r,c){jt(c,!1);const p=H(),D=H();let C=_e(c,"minValue",8,null),z=_e(c,"maxValue",8,null),q=_e(c,"actualValue",8),k=_e(c,"unit",8),Y=_e(c,"displayMin",8),N=_e(c,"displayMax",8);const fe="bg-green-300",Q="bg-red-300",ne="bg-gray-200";function ce(l,F,b,d,x){let A=50,u=[{color:ne,widthPercent:100}];if(b==null||isNaN(b))return{positionPercent:0,barSegments:[{color:ne,widthPercent:100}]};const re=x-d;if(re<=0)return console.warn("TargetProgressBar received invalid display range:",d,x),{positionPercent:50,barSegments:[{color:ne,widthPercent:100}]};A=Math.max(0,Math.min(100,(b-d)/re*100)),u=[];let y=0;const _=(h,G)=>{if(h===null)return 0;const P=Math.max(0,Math.min(100,(h-d)/re*100)),S=P-y;return S>.01&&u.push({color:G,widthPercent:S}),y=P,S};if(l!==null&&F!==null){_(l,Q),_(F,fe);const h=100-y;h>0&&u.push({color:Q,widthPercent:h})}else if(l!==null){_(l,Q);const h=100-y;h>0&&u.push({color:fe,widthPercent:h})}else if(F!==null){_(F,fe);const h=100-y;h>0&&u.push({color:Q,widthPercent:h})}else u.push({color:ne,widthPercent:100});const V=u.reduce((h,G)=>h+G.widthPercent,0);return V<99.9&&u.length>0?u[u.length-1].widthPercent+=100-V:V>100.1&&u.length>0&&(u[u.length-1].widthPercent-=V-100),{positionPercent:A,barSegments:u}}function ie(l){return Math.abs(l)>1e3||Math.abs(l)<1&&l!==0?l.toFixed(0):l.toFixed(1)}lt(()=>(e(p),e(D),Le(C()),Le(z()),Le(q()),Le(Y()),Le(N())),()=>{(l=>(s(p,l.positionPercent),s(D,l.barSegments)))(ce(C(),z(),q(),Y(),N()))}),Lt(),It();var ae=Ra(),X=i(ae);{var se=l=>{var F=Aa(),b=Qe(F);st(b,1,"relative w-full h-4 flex overflow-hidden rounded");var d=i(b);dt(d,1,()=>e(D),sa,(V,h)=>{var G=Na();J(()=>{st(G,1,e(h).color),Nt(G,`width: ${e(h).widthPercent??""}%;`)}),f(V,G)});var x=v(d,2);st(x,1,"absolute top-0 bottom-0 w-1 bg-black -ml-0.5"),n(b);var A=v(b,2),u=i(A),re=i(u);n(u);var y=v(u,2),_=i(y);n(y),n(A),J((V,h,G)=>{Nt(x,`left: ${e(p)??""}%;`),De(x,"title",V),$(re,`${h??""}${k()==="%"?"%":""}`),$(_,`${G??""}${k()==="%"?"%":""}`)},[()=>`Actual: ${q().toFixed(1)}${k()==="%"?"%":" "+k()}
Target: ${C()??"N/A"} - ${z()??"N/A"}${k()==="%"?"%":" "+k()}`,()=>ie(Y()),()=>ie(N())],Se),f(l,F)},E=l=>{var F=Va();st(F,1,"relative w-full h-4 bg-gray-200 rounded"),f(l,F)};B(X,l=>{q()!==null&&q()!==void 0&&!isNaN(q())?l(se):l(E,!1)})}n(ae),f(r,ae),Dt()}var Wa=w("<p>No nutrition targets have been defined yet. Go to Settings to add some.</p>"),Ba=w('<span class="text-xs text-red-600">Error</span>'),qa=w('<span class="text-sm text-gray-700"> </span>'),Ga=w('<span class="text-xs text-gray-500">N/A</span>'),Ka=w('<div class="h-4 bg-gray-300 rounded flex items-center justify-center"><span class="text-xs text-gray-600">Cannot display bar due to error</span></div>'),za=w('<div class="border-b pb-3"><div class="flex justify-between items-center mb-1"><span class="font-medium"> </span> <!></div> <div class="text-xs text-gray-500 mb-2"> </div> <!></div>'),Ya=w('<div class="space-y-4"></div>'),Ha=w('<div class="fixed inset-0 bg-black bg-opacity-50 z-40 flex justify-center items-center"><div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto z-50" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1"><div class="flex justify-between items-center mb-4"><h2 class="text-xl font-semibold" id="modal-title"> </h2> <button class="text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button></div> <!> <div class="mt-6 text-right"><button class="px-4 py-2 bg-gray-300 hover:bg-gray-400 rounded">Close</button></div></div></div>');function Xa(r,c){jt(c,!1);const p=H();let D=_e(c,"isOpen",8,!1),C=_e(c,"dailyTotals",24,()=>({})),z=_e(c,"targets",24,()=>[]),q=_e(c,"dateString",8,"");const k=aa(),Y={protein:3,fat:9,carbs:3.7,fibers:2};function N(E,l){return!E||l[E]===void 0||l[E]===null?0:l[E]}function fe(E,l){if(!l||Object.keys(l).length===0)return[];const F=Ft({protein:N("protein",l),fat:N("fat",l),carbs:N("carbs",l),fibers:N("fibers",l)}),b={...l,calories:F};return E.map(d=>{let x=null,A="g",u=null,re=0,y=100;try{const _=d.nutrient_1,V=d.nutrient_2;if(V===null)x=N(_,b),A=_==="calories"?"kcal":"g";else{A="%";const P=N(_,b);let S=N(V,b),W=P,me=S;if(V==="calories"){if(_==="protein"||_==="fat"||_==="carbs"||_==="fibers"){const ue=N("carbs",b)-N("fibers",b);_==="protein"?W=P*Y.protein:_==="fat"?W=P*Y.fat:_==="carbs"?W=ue*Y.carbs:_==="fibers"&&(W=P*Y.fibers)}else throw new Error(`Cannot calculate kcal % for ${_}`);me=b.calories}else if(V==="fat"&&["mufa","pufa","sfa"].includes(_))W=P,me=S;else if(_==="omega6"&&V==="omega3"||_==="pufa"&&V==="sfa")W=P,me=S;else throw new Error(`Unsupported relative target: ${_} / ${V}`);me===0?(x=null,u=`Cannot calculate ratio/percentage: Denominator (${V}) is zero.`):x=W/me*100}const G=(x??0)*1.05;if(V===null){re=0;const P=d.min_value,S=d.max_value;let W=100;S!==null?W=S*1.2:P!==null&&(W=P*2),W<=0&&(W=10),y=Math.max(W,G),y<=0&&(y=10)}else{re=0;let P=100;_==="omega6"&&V==="omega3"&&(d.max_value!==null?P=d.max_value*2:P=1e4),P<=0&&(P=100),y=Math.max(P,G),y<=0&&(y=100)}y<30?y=Math.ceil(y):y<300?y=Math.ceil(y/10)*10:y<3500?y=Math.ceil(y/100)*100:y=Math.ceil(y/1e3)*1e3}catch(_){console.error(`Error calculating target ${d.nutrient_1}/${d.nutrient_2}:`,_),u=_.message||"Calculation failed",x=null}return{...d,actualValue:x,displayUnit:A,displayLabel:ne(d.nutrient_1,d.nutrient_2),calculationError:u,displayMin:re,displayMax:y}})}const Q={protein_percent_calories:{label:"Protein (% of Calories)",n1:"protein",n2:"calories"},fat_percent_calories:{label:"Fat (% of Calories)",n1:"fat",n2:"calories"},carbs_percent_calories:{label:"Carbs (% of Calories)",n1:"carbs",n2:"calories"},omega6_omega3_ratio:{label:"Omega-6 / Omega-3 Ratio (%)",n1:"omega6",n2:"omega3"},pufa_sfa_ratio:{label:"PUFA / SFA Ratio (%)",n1:"pufa",n2:"sfa"},mufa_percent_fat:{label:"MUFA (% of Total Fat)",n1:"mufa",n2:"fat"},pufa_percent_fat:{label:"PUFA (% of Total Fat)",n1:"pufa",n2:"fat"},sfa_percent_fat:{label:"SFA (% of Total Fat)",n1:"sfa",n2:"fat"}};function ne(E,l){if(l===null){const F=E==="calories"?"kcal":"g";return`${E.charAt(0).toUpperCase()+E.slice(1)} (${F})`}else{const F=Object.keys(Q).find(b=>Q[b].n1===E&&Q[b].n2===l);return F?Q[F].label:`${E} / ${l} (%)`}}function ce(){k("close")}function ie(E){E.key==="Escape"&&ce()}lt(()=>(Le(z()),Le(C())),()=>{s(p,fe(z(),C()))}),Lt(),It();var ae=Ut();K("keydown",ra,ie);var X=Qe(ae);{var se=E=>{var l=Ha(),F=i(l),b=i(F),d=i(b),x=i(d);n(d);var A=v(d,2);n(b);var u=v(b,2);{var re=h=>{var G=Wa();f(h,G)},y=h=>{var G=Ya();dt(G,5,()=>e(p),P=>P.id,(P,S)=>{var W=za(),me=i(W),ue=i(me),Ze=i(ue,!0);n(ue);var ut=v(ue,2);{var et=ee=>{var pe=Ba();J(()=>De(pe,"title",e(S).calculationError)),f(ee,pe)},tt=(ee,pe)=>{{var mt=Te=>{var Oe=qa(),pt=i(Oe);n(Oe),J(gt=>$(pt,`Actual: ${gt??""} ${e(S).displayUnit??""}`),[()=>Math.round(e(S).actualValue)],Se),f(Te,Oe)},Ge=Te=>{var Oe=Ga();f(Te,Oe)};B(ee,Te=>{e(S).actualValue!==null?Te(mt):Te(Ge,!1)},pe)}};B(ut,ee=>{e(S).calculationError?ee(et):ee(tt,!1)})}n(me);var We=v(me,2),ft=i(We);n(We);var Be=v(We,2);{var qe=ee=>{var pe=Ka();f(ee,pe)},Ce=ee=>{const pe=Se(()=>e(S).actualValue??0);Ua(ee,{get minValue(){return e(S).min_value},get maxValue(){return e(S).max_value},get actualValue(){return e(pe)},get unit(){return e(S).displayUnit},get displayMin(){return e(S).displayMin},get displayMax(){return e(S).displayMax}})};B(Be,ee=>{e(S).calculationError?ee(qe):ee(Ce,!1)})}n(W),J(()=>{$(Ze,e(S).displayLabel),$(ft,`Target: ${e(S).min_value??"-"??""} to ${e(S).max_value??"-"??""} ${e(S).displayUnit??""}`)}),f(P,W)}),n(G),f(h,G)};B(u,h=>{e(p).length===0?h(re):h(y,!1)})}var _=v(u,2),V=i(_);n(_),n(F),n(l),J(()=>$(x,`Nutrition Target Details (${q()??""})`)),K("click",A,ce),K("click",V,ce),K("click",F,da(function(h){ca.call(this,c,h)})),K("click",l,ce),f(E,l)};B(X,E=>{D()&&E(se)})}f(r,ae),Dt()}var Ja=w('<p class="mt-2 text-sm text-gray-500">Loading food items...</p>'),Qa=w('<p class="mt-2 text-sm text-red-600"> </p>'),Za=w('<li><button type="button" class="block w-full text-left px-4 py-2 hover:bg-gray-100 cursor-pointer"> </button></li>'),er=w('<ul class="absolute z-10 mt-1 w-full border border-gray-200 rounded-md bg-white shadow-lg max-h-60 overflow-y-auto"></ul>'),tr=w('<p class="mt-2 text-sm text-gray-500">No matches found.</p>'),ar=w("<p>Loading recent logs...</p>"),rr=w('<p class="text-red-600"> </p>'),or=w('<li class="border-b-2 border-gray-300"><button type="button" class="w-full text-left block pt-4 pb-1 hover:bg-gray-100 transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1"><div class="flex justify-between items-baseline mb-1"><h3 class="text-base font-semibold text-gray-700"> </h3></div> <div class="flex flex-wrap items-center gap-x-1 gap-y-1 text-xs"><span class="bg-blue-200 text-blue-900 px-1 py-0.5 rounded-md font-medium pointer-events-none"> </span> <span class="bg-green-200 text-green-900 px-1 py-0.5 rounded-md font-medium pointer-events-none"> <span class="text-green-700 text-[0.65rem]">PFC</span></span> <span class="bg-yellow-200 text-yellow-900 px-1 py-0.5 rounded-md font-medium pointer-events-none"> <span class="text-yellow-700 text-[0.65rem]">FiS</span></span> <span class="bg-orange-200 text-orange-900 px-1 py-0.5 rounded-md font-medium pointer-events-none"> <span class="text-orange-700 text-[0.65rem]">MPS</span></span> <span class="bg-orange-200 text-orange-900 px-1 py-0.5 rounded-md font-medium pointer-events-none" title="Omega-6:Omega-3 Ratio"> <span class="text-orange-700 text-[0.65rem]">6:3</span></span> <span class="bg-purple-200 text-purple-900 px-1 py-0.5 rounded-md font-medium pointer-events-none"> </span></div></button></li>'),nr=w('<input type="datetime-local" class="absolute -left-full w-px h-px opacity-0" aria-label="Edit timestamp"> <span class="px-1 rounded block" title="Editing time..."> </span>',1),ir=w('<span class="cursor-pointer hover:bg-gray-200 px-1 rounded block" role="button" tabindex="0" title="Click to edit timestamp"> </span>'),sr=w('<input type="number" step="0.1" class="px-1 py-0 border border-blue-300 rounded text-sm w-16" aria-label="Edit multiplier">'),lr=w('<span class="text-xs text-gray-500 mr-1"> </span>'),dr=w('<span class="cursor-pointer hover:bg-gray-200 px-1 rounded" role="button" tabindex="0" title="Click to edit multiplier"><!> </span>'),cr=w('<div class="pl-1 pt-1 mt-1 border-t border-gray-200 flex flex-wrap items-center gap-x-1 gap-y-1 text-xs"><span class="bg-blue-100 text-blue-800 px-1 py-0.5 rounded-md"> </span> <span class="bg-green-100 text-green-800 px-1 py-0.5 rounded-md"> <span class="text-green-600 text-[0.65rem]">PFC</span></span> <span class="bg-yellow-100 text-yellow-800 px-1 py-0.5 rounded-md"> <span class="text-yellow-600 text-[0.65rem]">FiS</span></span> <span class="bg-orange-100 text-orange-800 px-1 py-0.5 rounded-md"> <span class="text-orange-600 text-[0.65rem]">MPS</span></span> <span class="bg-orange-100 text-orange-800 px-1 py-0.5 rounded-md"><!> <span class="text-orange-600 text-[0.65rem]">6:3</span></span> <span class="bg-purple-100 text-purple-800 px-1 py-0.5 rounded-md"> </span></div>'),ur=w('<li class="p-2 border rounded-md bg-gray-50"><div class="flex justify-between items-center min-h-[2.5rem]"><div class="flex items-center flex-grow mr-2 overflow-hidden"><div class="text-sm text-gray-600 w-12 flex-shrink-0 relative mr-2"><!></div> <span class="text-sm truncate flex-shrink min-w-0 mr-2"> </span> <div class="text-sm text-gray-600 flex-shrink-0"><!></div></div> <div class="flex items-center flex-shrink-0 space-x-1"><button type="button" class="p-1 text-blue-700 bg-blue-100 rounded hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-blue-500" title="Copy as new entry (now)">📋</button> <button type="button" class="p-1 text-red-700 bg-red-100 rounded hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div>  <!></li>'),fr=w('<div class="mt-6 text-center"><button type="button" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50"><!></button></div>'),mr=w('<ul class="space-y-2"></ul> <!>',1),pr=w("<p>No food logged yet.</p>"),gr=w('<div class="container mx-auto p-4 max-w-5xl"><h1 class="text-2xl font-bold mb-4">Log Food</h1> <div class="mb-6 relative"><label for="food-search" class="block text-sm font-medium text-gray-700 mb-1">Search Food Item:</label> <input type="text" id="food-search" placeholder="Start typing..." class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"> <!></div> <hr class="my-6 mt-12"> <div><div class="flex justify-between items-center mb-3"><h2 class="text-xl font-semibold">Recent Logs</h2> <a href="/create-recipe" class="btn btn-sm btn-outline btn-primary">Create Recipe</a></div> <!></div> <!></div>');function Or(r,c){jt(c,!1);let p=H(""),D=H([]),C=H([]),z=H([]),q=[],k=null,Y=H([]),N=H(!1),fe=H({}),Q=H("");function ne(a,t){s(Q,a),s(fe,t),s(N,!0)}function ce(){s(N,!1)}let ie=H(!0),ae=H(!0),X=H(null),se=H(null),E=!1,l=H(!1),F=H(!0);const b=50;let d=0,x=H(null),A=H(null),u=H("");function re(a){if(!a)return"Invalid Time";try{const t=new Date(a),O={hour:"numeric",minute:"numeric",hour12:!1};return t.toLocaleTimeString("sv-SE",O)}catch(t){return console.error("Error formatting time:",t),"Invalid Time"}}function y(a){if(!a)return"Invalid Date";try{const t=new Date(a),O=t.getFullYear(),R=(t.getMonth()+1).toString().padStart(2,"0"),m=t.getDate().toString().padStart(2,"0");return`${O}-${R}-${m}`}catch(t){return console.error("Error getting local date string:",t),"Invalid Date"}}function _(a){if(!a)return"";try{const t=new Date(a);if(isNaN(t.getTime()))return"";const O=t.getFullYear(),R=(t.getMonth()+1).toString().padStart(2,"0"),m=t.getDate().toString().padStart(2,"0"),g=t.getHours().toString().padStart(2,"0"),M=t.getMinutes().toString().padStart(2,"0");return`${O}-${R}-${m}T${g}:${M}`}catch(t){return console.error("Error converting ISO to datetime-local string:",t),""}}function V(a){if(!a)return"";try{const t=new Date(a);if(isNaN(t.getTime()))throw new Error("Invalid date created from datetime-local string");return t.toISOString()}catch(t){return console.error("Error converting datetime-local to ISO:",t),""}}function h(a,t,O){a.key==="Enter"&&(a.preventDefault(),P(t,O))}function G(a){a.key==="Enter"?(a.preventDefault(),W()):a.key==="Escape"&&S()}async function P(a,t){if(s(x,a.id),s(A,t),t==="multiplier")s(u,a.multiplier);else{s(u,_(a.logged_at)),await ia();const O=document.getElementById(`datetime-edit-${a.id}`);if(O)try{O.showPicker()}catch(R){console.error("Browser might not support showPicker() or input isn't ready/interactive.",R)}}}function S(){s(x,null),s(A,null),s(u,"")}async function W(){if(e(x)===null||e(A)===null)return;let a={},t;if(e(A)==="multiplier"){if(t=Number(e(u)),isNaN(t)){console.error("Invalid multiplier value"),s(X,"Multiplier must be a valid number.");return}a.multiplier=t}else{if(t=V(e(u)),!t){console.error("Invalid timestamp value from datetime-local input."),s(X,"Invalid date/time selected.");return}a.logged_at=t}s(X,null);try{const{error:O}=await je.from("food_log").update(a).eq("id",e(x));if(O)throw O;S(),await ue()}catch(O){console.error("Error updating log:",O),s(X,`Failed to update log: ${O.message}`)}}async function me(){try{const{data:a,error:t}=await je.from("nutrition_targets").select("*");if(t)throw t;s(Y,a||[])}catch(a){console.error("Error fetching nutrition targets:",a),`${a.message}`,s(Y,[])}finally{}}async function ue(a=!1){a?(s(l,!0),d++):(s(ie,!0),d=0,s(C,[]),s(z,[])),s(X,null);const t=d*b,O=t+b-1;try{const{data:R,error:m}=await je.from("food_log").select(`
          id,
          logged_at,
          multiplier,
          food_item_id,
          food_items (
            id,
            name,
            protein,
            fat,
            carbs,
            fibers,
            sugar,
            mufa,
            pufa,
            sfa,
            gl,
            omega3,
            omega6,
            serving_qty,
            serving_unit
          )
        `).order("logged_at",{ascending:!1}).range(t,O);if(m)throw m;const g=R?R.map(M=>{const I=M.food_items;return{id:M.id,logged_at:M.logged_at,multiplier:M.multiplier,food_item_id:M.food_item_id,food_items:I?{id:I.id,name:I.name,protein:I.protein,fat:I.fat,carbs:I.carbs,fibers:I.fibers,sugar:I.sugar,mufa:I.mufa,pufa:I.pufa,sfa:I.sfa,gl:I.gl,omega3:I.omega3,omega6:I.omega6,serving_qty:I.serving_qty,serving_unit:I.serving_unit}:null}}):[];a?s(C,[...e(C),...g]):s(C,g),s(F,g.length===b)}catch(R){console.error("Error fetching recent logs:",R),s(X,R.message||"Failed to fetch recent logs."),a&&d--}finally{s(ie,!1),s(l,!1),Ze()}}function Ze(){const a=["protein","fat","carbs","fibers","sugar","mufa","pufa","sfa","gl","omega3","omega6"],t={};for(const m of e(C)){const g=y(m.logged_at);t[g]||(t[g]={logs:[],totals:{}}),t[g].logs.push(m),m.food_items&&a.forEach(M=>{var Z;const I=(Z=m.food_items)==null?void 0:Z[M];typeof I=="number"&&(t[g].totals[M]===void 0&&(t[g].totals[M]=0),t[g].totals[M]+=I*m.multiplier)})}for(const m in t){const g=t[m].totals,M=g.omega3??0,I=g.omega6??0;if(M>0){const Z=(I/M).toFixed(1);g.ratio=`${Z}:1`}else I>0?g.ratio="∞:1":g.ratio="-"}const O=[],R=Object.keys(t).sort((m,g)=>g.localeCompare(m));for(const m of R){const g=Object.fromEntries(a.map(M=>[M,t[m].totals[M]??0]));O.push({type:"summary",date:m,totals:g,ratio:t[m].totals.ratio});for(const M of t[m].logs)O.push({type:"log",data:M})}s(z,O)}async function ut(){s(ae,!0),s(se,null);try{const{data:a,error:t}=await je.from("food_items").select("id, name");if(t)throw console.error("fetchAllFoodItems - Supabase error object:",t),t;a?q=a:(console.warn("fetchAllFoodItems - No data returned from food_items."),q=[]),q.length>0?k=new la(q,{keys:["name"],includeScore:!0,threshold:.4}):k=null}catch(a){console.error("Error fetching all food items:",a),s(se,a.message||"Failed to fetch food items."),q=[],k=null}finally{s(ae,!1)}}oa(async()=>{await ue(),await ut(),await me()});const et=Ca(()=>{if(!k||!e(p).trim()){s(D,[]);return}const a=k.search(e(p).trim());s(D,a.slice(0,5).map(t=>t.item))},300);na(()=>{et.cancel()});async function tt(a){if(!E){E=!0;try{const{error:t}=await je.from("food_log").insert([{food_item_id:a.id,multiplier:1,logged_at:new Date().toISOString()}]);if(t)throw t;s(p,""),s(D,[]),await ue()}catch(t){console.error("Error logging item:",t),s(X,`Failed to log ${a.name}: ${t.message}`)}finally{E=!1}}}async function We(a){if(!a.food_item_id){console.error("Cannot copy log: food_item_id is missing.",a),s(X,"Cannot copy log: Missing food item reference.");return}try{const{error:t}=await je.from("food_log").insert([{food_item_id:a.food_item_id,multiplier:a.multiplier,logged_at:new Date().toISOString()}]);if(t)throw t;await ue()}catch(t){console.error("Error copying log:",t),s(X,`Failed to copy log: ${t.message}`)}}async function ft(a,t){if(confirm(`Are you sure you want to delete the log for "${t??"this item"}"?`))try{const{error:R}=await je.from("food_log").delete().match({id:a});if(R)throw R;await ue()}catch(R){console.error("Error deleting log:",R),s(X,`Failed to delete log: ${R.message}`)}}lt(()=>(e(C),e(ie)),()=>{e(C)&&!e(ie)&&Ze()}),lt(()=>e(p),()=>{e(p)?et():s(D,[])}),Lt(),It();var Be=gr(),qe=v(i(Be),2),Ce=v(i(qe),2);Et(Ce);var ee=v(Ce,2);{var pe=a=>{var t=Ja();f(a,t)},mt=(a,t)=>{{var O=m=>{var g=Qa(),M=i(g);n(g),J(()=>$(M,`Error loading food items: ${e(se)??""}`)),f(m,g)},R=(m,g)=>{{var M=Z=>{var ge=er();dt(ge,5,()=>e(D),be=>be.id,(be,xe)=>{var $e=Za(),oe=i($e),j=i(oe,!0);n(oe),n($e),J(()=>$(j,e(xe).name)),K("click",oe,()=>tt(e(xe))),K("keydown",oe,ye=>ye.key==="Enter"&&tt(e(xe))),f(be,$e)}),n(ge),f(Z,ge)},I=(Z,ge)=>{{var be=xe=>{var $e=tr();f(xe,$e)};B(Z,xe=>{e(p)&&!e(ae)&&e(D).length===0&&xe(be)},ge)}};B(m,Z=>{e(p)&&e(D).length>0?Z(M):Z(I,!1)},g)}};B(a,m=>{e(se)?m(O):m(R,!1)},t)}};B(ee,a=>{e(ae)?a(pe):a(mt,!1)})}n(qe);var Ge=v(qe,4),Te=v(i(Ge),2);{var Oe=a=>{var t=ar();f(a,t)},pt=(a,t)=>{{var O=m=>{var g=rr(),M=i(g);n(g),J(()=>$(M,`Error: ${e(X)??""}`)),f(m,g)},R=(m,g)=>{{var M=Z=>{var ge=mr(),be=Qe(ge);dt(be,5,()=>e(z),oe=>oe.type==="log"?oe.data.id:oe.date,(oe,j)=>{var ye=Ut(),vt=Qe(ye);{var _t=le=>{var he=or(),Fe=i(he),Pe=i(Fe),Ne=i(Pe),o=i(Ne,!0);n(Ne),n(Pe);var Ae=v(Pe,2),Ie=i(Ae),Ke=i(Ie);n(Ie);var ze=v(Ie,2),xt=i(ze);Ee(),n(ze);var Ye=v(ze,2),Ve=i(Ye);Ee(),n(Ye);var He=v(Ye,2),at=i(He);Ee(),n(He);var Xe=v(He,2),yt=i(Xe);Ee(),n(Xe);var rt=v(Xe,2),ot=i(rt);n(rt),n(Ae),n(Fe),n(he),J((Me,nt,ht,wt,L,T,U,te,we,de)=>{De(Fe,"title",`Click to view target details for ${e(j).date??""}`),$(o,e(j).date),$(Ke,`${Me??""} C`),$(xt,`${nt??""}, ${ht??""}, ${wt??""} `),$(Ve,`${L??""}, ${T??""} `),$(at,`${U??""}, ${te??""}, ${we??""} `),$(yt,`${e(j).ratio??"-"??""} `),$(ot,`${de??""} GL`)},[()=>Ft(e(j).totals),()=>Math.round(e(j).totals.protein??0),()=>Math.round(e(j).totals.fat??0),()=>Math.round(e(j).totals.carbs??0),()=>Math.round(e(j).totals.fibers??0),()=>Math.round(e(j).totals.sugar??0),()=>Math.round(e(j).totals.mufa??0),()=>Math.round(e(j).totals.pufa??0),()=>Math.round(e(j).totals.sfa??0),()=>Math.round(e(j).totals.gl??0)],Se),K("click",Fe,()=>ne(e(j).date,e(j).totals)),K("keydown",Fe,Me=>{(Me.key==="Enter"||Me.key===" ")&&ne(e(j).date,e(j).totals)}),f(le,he)},bt=(le,he)=>{{var Fe=Pe=>{var Ne=ur();const o=Se(()=>e(j).data);var Ae=i(Ne),Ie=i(Ae),Ke=i(Ie),ze=i(Ke);{var xt=L=>{var T=nr(),U=Qe(T);Et(U);var te=v(U,2),we=i(te,!0);n(te),J(de=>{De(U,"id",`datetime-edit-${e(o).id}`),$(we,de)},[()=>re(e(o).logged_at)],Se),Ot(U,()=>e(u),de=>s(u,de)),K("keydown",U,G),K("blur",U,W),K("change",U,W),f(L,T)},Ye=L=>{var T=ir(),U=i(T,!0);n(T),J(te=>$(U,te),[()=>re(e(o).logged_at)],Se),K("click",T,()=>P(e(o),"timestamp")),K("keydown",T,te=>h(te,e(o),"timestamp")),f(L,T)};B(ze,L=>{e(x)===e(o).id&&e(A)==="timestamp"?L(xt):L(Ye,!1)})}n(Ke);var Ve=v(Ke,2),He=i(Ve,!0);n(Ve);var at=v(Ve,2),Xe=i(at);{var yt=L=>{var T=sr();Et(T),Ot(T,()=>e(u),U=>s(u,U)),K("keydown",T,G),K("blur",T,W),f(L,T)},rt=L=>{var T=dr(),U=i(T);{var te=de=>{var ve=lr(),Re=i(ve);n(ve),J(()=>$(Re,`(${e(o).food_items.serving_qty??""}${e(o).food_items.serving_unit??""})`)),f(de,ve)};B(U,de=>{var ve,Re;(ve=e(o).food_items)!=null&&ve.serving_qty&&((Re=e(o).food_items)!=null&&Re.serving_unit)&&de(te)})}var we=v(U);n(T),J(()=>$(we,` x${e(o).multiplier??""}`)),K("click",T,()=>P(e(o),"multiplier")),K("keydown",T,de=>h(de,e(o),"multiplier")),f(L,T)};B(Xe,L=>{e(x)===e(o).id&&e(A)==="multiplier"?L(yt):L(rt,!1)})}n(at),n(Ie);var ot=v(Ie,2),Me=i(ot),nt=v(Me,2);n(ot),n(Ae);var ht=v(Ae,2);{var wt=L=>{var T=cr(),U=i(T),te=i(U);n(U);var we=v(U,2),de=i(we);Ee(),n(we);var ve=v(we,2),Re=i(ve);Ee(),n(ve);var St=v(ve,2),qt=i(St);Ee(),n(St);var Tt=v(St,2),Gt=i(Tt);{var Kt=ke=>{var Ue=it("-");f(ke,Ue)},zt=ke=>{var Ue=it();J((Mt,kt)=>$(Ue,`${Mt??""}, ${kt??""}`),[()=>Math.round((e(o).food_items.omega6??0)*e(o).multiplier),()=>Math.round((e(o).food_items.omega3??0)*e(o).multiplier)],Se),f(ke,Ue)};B(Gt,ke=>{Math.round((e(o).food_items.omega6??0)*e(o).multiplier)===0&&Math.round((e(o).food_items.omega3??0)*e(o).multiplier)===0?ke(Kt):ke(zt,!1)})}Ee(2),n(Tt);var Ct=v(Tt,2),Yt=i(Ct);n(Ct),n(T),J((ke,Ue,Mt,kt,Ht,Xt,Jt,Qt,Zt,ea)=>{$(te,`${ke??""} C`),$(de,`${Ue??""}, ${Mt??""}, ${kt??""} `),$(Re,`${Ht??""}, ${Xt??""} `),$(qt,`${Jt??""}, ${Qt??""}, ${Zt??""} `),$(Yt,`${ea??""} GL`)},[()=>Ft({protein:(e(o).food_items.protein??0)*e(o).multiplier,fat:(e(o).food_items.fat??0)*e(o).multiplier,carbs:(e(o).food_items.carbs??0)*e(o).multiplier,fibers:(e(o).food_items.fibers??0)*e(o).multiplier}),()=>Math.round((e(o).food_items.protein??0)*e(o).multiplier),()=>Math.round((e(o).food_items.fat??0)*e(o).multiplier),()=>Math.round((e(o).food_items.carbs??0)*e(o).multiplier),()=>Math.round((e(o).food_items.fibers??0)*e(o).multiplier),()=>Math.round((e(o).food_items.sugar??0)*e(o).multiplier),()=>Math.round((e(o).food_items.mufa??0)*e(o).multiplier),()=>Math.round((e(o).food_items.pufa??0)*e(o).multiplier),()=>Math.round((e(o).food_items.sfa??0)*e(o).multiplier),()=>Math.round((e(o).food_items.gl??0)*e(o).multiplier)],Se),f(L,T)};B(ht,L=>{e(o).food_items&&L(wt)})}n(Ne),J(()=>{var L,T,U,te;De(Ve,"title",((L=e(o).food_items)==null?void 0:L.name)??"(Deleted item)"),$(He,((T=e(o).food_items)==null?void 0:T.name)??"(Deleted item)"),De(Me,"aria-label",`Copy log for ${((U=e(o).food_items)==null?void 0:U.name)??"(Deleted item)"} as new entry`),De(nt,"aria-label",`Delete log for ${((te=e(o).food_items)==null?void 0:te.name)??"(Deleted item)"}`)}),K("click",Me,()=>We(e(o))),K("click",nt,()=>{var L;return ft(e(o).id,(L=e(o).food_items)==null?void 0:L.name)}),f(Pe,Ne)};B(le,Pe=>{e(j).type==="log"&&Pe(Fe)},he)}};B(vt,le=>{e(j).type==="summary"?le(_t):le(bt,!1)})}f(oe,ye)}),n(be);var xe=v(be,2);{var $e=oe=>{var j=fr(),ye=i(j),vt=i(ye);{var _t=le=>{var he=it("Loading...");f(le,he)},bt=le=>{var he=it("Load More");f(le,he)};B(vt,le=>{e(l)?le(_t):le(bt,!1)})}n(ye),n(j),J(()=>ye.disabled=e(l)),K("click",ye,()=>ue(!0)),f(oe,j)};B(xe,oe=>{!e(ie)&&e(F)&&oe($e)})}f(Z,ge)},I=Z=>{var ge=pr();f(Z,ge)};B(m,Z=>{e(z).length>0?Z(M):Z(I,!1)},g)}};B(a,m=>{e(X)?m(O):m(R,!1)},t)}};B(Te,a=>{e(ie)?a(Oe):a(pt,!1)})}n(Ge);var gt=v(Ge,2);Xa(gt,{get dailyTotals(){return e(fe)},get targets(){return e(Y)},get dateString(){return e(Q)},get isOpen(){return e(N)},set isOpen(a){s(N,a)},$$events:{close:ce},$$legacy:!0}),n(Be),J(()=>Ce.disabled=e(ae)),Ot(Ce,()=>e(p),a=>s(p,a)),f(r,Be),Dt()}export{Or as component};
